---
title: Text Mining FOMC
author: Christoffer Nordenlöw
date: '2021-01-10'
slug: []
categories:
  - R
  - Python
  - FOMC
  - Minutes
tags:
  - R
  - Python
  - FOMC
  - Minutes
description: ''
topics: []
output:
  blogdown::html_page:
  #  self_contained: false
    toc: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```




```{r, echo=FALSE, messages=FALSE,warning=FALSE,include=FALSE}

library(tidyverse)
library(lubridate)
library(slider)
library(dplyr, warn.conflicts = FALSE)
library(lubridate, warn.conflicts = FALSE)


library(ggrepel)




###source plots
source('C:\\Users\\chris\\Documents\\Python\\text-mining-fomc\\r_plots.R')


#setting overlaps for ggrepel
options(ggrepel.max.overlaps = Inf)

df <- read.table(
"C:\\Users\\chris\\Documents\\Python\\text-mining-fomc\\data\\fomcMinutesSummary.csv",  ##på detta sätt läser den ur aktuell mapp
  sep=",", header=TRUE)


#Change dates
df <- df %>%
  mutate(date = as.Date(gsub("\\D", "", date), format = "%Y%m%d"))


#arrange
df <- arrange(df, date)



#numrera antal protokoll
temp <- df%>%
  select(date) %>%
  distinct() %>%
  mutate(num = 1:n())

df <- merge(df, temp, by = "date", all.x = TRUE)


###sliding mean
df <- df  %>%
  group_by(subject, additional) %>% 
  mutate(avg_st = slide_index_dbl(frequency, num, mean, .before=3, .after=-1,.complete=T)) %>% ##dont include the current
  mutate(avg_lt = mean(frequency))%>%
  mutate(avg_st_share = slide_index_dbl(frequency_share, num, mean, .before=3, .after=-1,.complete=T))%>%
  mutate(avg_lt_share = mean(frequency_share))%>%
  mutate(ma_3m = slide_index_dbl(frequency, num, mean, .before=2, .after=0, .complete=T))%>%
  mutate(ma_3m_share = slide_index_dbl(frequency_share, num, mean, .before=2, .after=0, .complete=T))


#exclude first three rows to only include when 3m_moving is on
df <-df %>%
  filter(num > 3)

#one minute lag
df <- df %>%
  group_by(subject, additional) %>%
  mutate(previous = lag(frequency, n = 1, default = NA)) %>%
  mutate(previous_share = lag(frequency_share, n = 1, default = NA))



df <- df %>%
  mutate(chg_previous = frequency - previous)%>%
  mutate(chg_avg_st = frequency - avg_st)%>%
  mutate(chg_avg_lt = frequency - avg_lt)%>%
  mutate(chg_previous_share = frequency_share - previous_share)%>%
  mutate(chg_avg_st_share = frequency_share - avg_st_share)%>%
  mutate(chg_avg_lt_share = frequency_share - avg_lt_share)

  





###fed funds rate


df2 <- read.table(
  "C:\\Users\\chris\\Documents\\Python\\text-mining-fomc\\data\\fedfundsRate.csv", 
  sep=",", header=TRUE)


#Change dates
df2 <- df2 %>%
  mutate(date = as.Date(gsub("\\D", "", date), format = "%Y%m%d"))


#arrange
df2 <- arrange(df2, date)

df2 <- df2%>%
  filter(bound == "lower_bound")%>%
  select(-bound)



df <- merge(df, df2, by ="date", all.x =  TRUE)

df <- as.data.frame(df)
df[is.na(df)] <- 0




```


### General sentiment

#### Net sentiment
*Net sentiment is calculated by extracting all positive and negative words, and then taking the difference between these divided by the total number of words.*
```{r, echo=FALSE, messages=FALSE, warning=FALSE}

#```{r, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}
#plot spread, average sentiment trending down

temp <- df %>%
  filter(category == "sentiment")%>%
  filter(subject == "net_sentiment")%>%
 # mutate(sign = if_else(chg_avg >= 0, "Positive", "Negative"))  %>%
#  as.data.frame(temp)%>%
  pivot_longer(-c("category", "subject", "additional", "date"), values_to = "values")%>%
  filter(name %in% c("chg_avg_lt_share"))%>%
  mutate(change_positive = values > 0)


c_title = "Net sentiment index"
c_subtitle = "Net sentiment (positive - negative words) vs average"
c_caption = "Source: FOMC Minutes, own calculations."
c_x_axis = ""
c_y_axis = "Sentiment index"



ggplot(data = temp,
            mapping = aes(x = date, y = values, fill = change_positive))+
  geom_col() + guides(fill = FALSE) +
    theme_light()+
  #  theme_minimal(base_size=8)+
  theme(legend.position="bottom",
        plot.caption=element_text(hjust=0),
        plot.subtitle=element_text(face="italic"),
        plot.title=element_text(size=16,face="bold"))+
  labs(x=c_x_axis,y=c_y_axis,
       title=c_title,
       subtitle=c_subtitle,
       caption=c_caption)+
  scale_color_manual(values=c("#d73027","#4575b4"),name="Net sentiment Above/Below moving average sentiment")+
  scale_y_continuous(limits=c(-max(abs(temp$values)),max(abs(temp$values))))



```